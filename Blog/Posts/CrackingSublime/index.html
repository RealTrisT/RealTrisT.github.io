<!DOCTYPE html>
<html>
<head>
  <title>Blog - TrisT</title>
<style>
/*------------------------ body --------------------*/
  body{
    margin: 0px;
    background-color: #36393e;
  }


/*----------------------- navbar -------------------*/
  .navbarul {
      font-family: "Courier New", Courier, monospace;
      list-style-type: none;
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #2f3136;
  }

  .navbarli {
      float: left;
  }

  .navbarli a {
      display: block;
      color: white;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
  }

  .navbarli a:hover:not(.navbaractive) {
      background-color: #111;
  }

  .navbaractive {
      background-color: #a742f4;
  }


/*---------------------- content -------------------*/
  #main_text{
    font-family: "Lucida Console", Monaco, monospace;
    margin: 20px;
    color: #e0e0e0;
  }

  #lePost{
    font-family: "Courier New", Courier, monospace;
    color: #ccbfb5;
  }

  #lePost a:link {
      color: #ad77d6;
      text-decoration: none;
  }

  #lePost a:visited {
      color: #ad77d6;
      text-decoration: none;
  }

  #lePost a:hover {
      color: #9741d8;
      text-decoration: none;
  }

  #lePost a:active {
      color: red;
  }


  .code{
    display: inline-flex;
    background: #2f3136;
    font-size: 0.875rem;
    line-height: 1rem;
    text-indent: 0;
    color: #839496;
    padding: .5em;
    font-family: Menlo,Consolas,Monaco,monospace;
    vertical-align: baseline;
    white-space: pre-wrap;
    word-wrap: break-word;
    user-select: text;
    -webkit-box-direction: normal;
    text-rendering: optimizeLegibility;
    border: 2px solid #111214;
    border-radius: 5px;
    padding-left: 20px;
    padding-right: 25px;
  }

  .smallcode{
    background: #161719;    
    color: #d1cdbe;
    border: 1px solid #141413;
    border-radius: 5px;
    font-family: Menlo,Consolas,Monaco,monospace;
    padding: 0;
    padding-left: 10px;
    padding-right: 10px;
    padding-bottom: 1px;
  }
}

</style>
</head>
<body>

<ul class="navbarul">
  <li class="navbarli"><a href="../../../">Home</a></li>
  <li class="navbarli"><a class="navbaractive" href="../../">Blog</a></li>
  <li class="navbarli"><a href="../../../Projects">Projects</a></li> 
  <li class="navbarli"><a href="../../../About">About</a></li>
  <li class="navbarli" style="float:right;"><div style="display: block; text-align: center; color: white; padding: 14px 16px;">Monospace Font Master Race</div></li>
</ul>

<div class="lecontent" id="main_text">
  <br>
  <center>
    <h1><span style='font-family: "Courier New", Courier, monospace'>Aight</span></h1>
    <h3><i><font color="#ffaa00">Cracking</font>: Sublime</i></h3>
  </center>
  <hr><br>
  <div id="lePost">
<!--
  [h20][<~ What ~>]
Decided to crack sublime text, not because I had to, just for fun, the message or unregistered thing never bothered me a bit. 
Whenever I'll have $80 to throw around and support devs, I will, but until then, I'll have fun cracking shit.


[h20][<~ TL;DR ~>]
I messed up bad in the beginning, made some bad assumptions, everything you need is in the first few lines of the "Process" section, and from "The Big Gay" down.


[h20][<~ Process ~>]

Started with trying to find the (UNREGISTERED) thing. Was not in the strings.

So I went Imports, Since the window was always the same, they'd have to call SetWindowsText.

And there it was:
[img src="https://imgur.com/J1wEAVg.png"]

It had only 2 xrefs, and in the first you could find this:
[img src="https://imgur.com/ZvFu0Fw.png"]

Now if you notice on the left we have a bit of a loop. There's a weird ass string. 
As we can see the loop xors the deference of the pointer by 0x15, and then increments the pointer.
Doing it yourself yeilds the following result:
[img src="https://imgur.com/p1RqhNr.png"]

Ez.

Now we've got 2 conditions onthere, the first checks is if (let's call it) "Somethung" & 2, and if it's 1 it does the decrypt thing.
That tells us that that dword & 2 is basically a ``IsUnregistered``

The other alternative is one that checks Somethung & 4, and if that's true, it goes forward and calls SetWindowText, otherwise it seemingly appends "(LISENSE UPGRADE REQUIRED)", telling us that dword & 4 is basically ``IsLisenceUpgradNeeded``.

Maybe this'll be easier to visualize:
```c
if(license_info & 2)
  showUNREGISTERED();
else if(license_info & 4)
  showLICENSEUPGRADEREQUIRED();
else  GoOn();
```

Now we could just jmp the two conditions, be set and go on to crack the save message, but we preferably want to make the program itself think it's "registered", so anything else having the free version might trigger will go away.

So I trace it back. See what sets that value. Somwhere along the way I find this:
[img src="https://imgur.com/PlF8tyF.png"]

So now we know that that struct+1240+1 contains a byte/bool that seems to be ``UpgradeRequired``. And also that struct+1240 contains a byte/bool for ``IsRegistered``.

Again, easier to visualize:
```c
License_Info__ = 0;
if(!Something_Lisence_->isRegistered)
  License_Info__ = 2
if(!Something_Lisence_->UpgradeRequired)
  License_Info__ |= 4;
```

Now, that ``Something_License_`` is the first param to that function (rcx). Function has a shit tone of xrefs tho (which is not at all bad, just means a lot of code uses it).
So now we go dynamic.

RCX doesn't seem to change between calls. Great! So let's see what accesses it.
[img src="https://imgur.com/9O1sPaD.png"]

Bit of a problem.
So those 204s you see, are when the cursor blinks, those 826s are when you move the mouse. So this seems to be some display class.
Since the class was passed as first param and this is display, chances are there's a vtable. Let's see.
[img src="https://i.imgur.com/KOCwWhB.png"]

Great, so we can go back to static.
So that 00007FF741F64060 - sublime_text.exe is ``524060``:
[img src="https://imgur.com/OUvKApn.png"]

And since I coded a PE dumper with rtti, we can check what that actually is:
[img src="https://imgur.com/wwD375y.png"]

So ``edit_window`` with estimated 55 virtual functions. Doesn't help a lot since we already deduced that it was some kind of display stuff.

Okay, if we wanna find the license stuff, we gotta see how that edit_window+1240 is set. Now I find no reason as to why that would be set twice (besides someone actually activating it), so maybe check some kind of constructor.
Because this is has a vtable, identifying a constructor is a matter of xrefing the vtable pointer.

A bit down on the first of 2 xrefed functions, we find:
[img src="https://imgur.com/x4jqrHo.png"]

The fact that that is a11 is great, because assuming this function is a constructor (and it sure looks like it), that'd be one of the params.
There's only 1 xref to this function:
[img src="https://imgur.com/sNOEIhg.png"]

v7+72, feeling it rn. v7 is a1 for that function, so let's bp it and see.
So it only seems to get called when you create another window. (What we need is something that is only called when sublime is started and maybe sporadically)

So now there's 2 things:
[img src="https://imgur.com/fS9xdX2.png"]

and a ``524498`` vtable

[img src="https://imgur.com/C24PxyU.png"]

window_list, cool.
So window_list + 72 is seemingly the license info.
I'm gonna go for that pointer first. ``sublime_text.exe+6A7AD0``

So, V7+72 always seems to have the same value, which is 0xC8. Now that doesn't really add up with the rest of the code we've been following and the values, but at least we know it's got something to do with the lisence.

Imma start it manually with x64dbg and hopefully bp it.
Results:
``00007FF741A62CD8 (RVA:22CD8) | 4C 89 05 F1 4D 68 00     | mov qword ptr ds:[7FF7420E7AD0(RVA:6A7AD0)],r8      |``

Great! IDA time.
[img src="https://imgur.com/1q1sA9E.png"]

Ok, so this seems to be what sets the pointers. Gladly there's only one xref.

And we're now seeing some cool shit!
[img src="https://imgur.com/ObhDpH8.png"]
[img src="https://imgur.com/zSgFrfq.png"]
[img src="https://imgur.com/g0xv7ks.png"]

This means we're close. But I doubt it's gonna be easy.

Anywho, we know from the prev function, the window_list is the third arg (r8), so let's see where it's set.
It would seem the binary does some weird stuff that confuses the decompiler, so this is gonna have to be asm only.

Here's the pointer to the previous function:
[img src="https://imgur.com/3CllFsH.png"]

And it's only used again towards the end of the function (in what I find is a weird fashion):
[img src="https://imgur.com/PF6eyb4.png"]
R8 is set before, depending on a condition, so chances are this is the 1st stack variable.

Anyhow, we'll need to bp this call (RVA: 3A744), otherwise there's no way to know what that function is, since the only xref to the current function is in rdata.
Feelsbad. Seems like it's never called!?
I mean the function itself is, so at least we can go back to the caller to see if there's something interesting.

~Fucking exceptions~

Okay, so I BPd the beginning and the end of the function, in the beginning there's no window, by the end there already is (with the unregistered window name and everything).
The call is made at ``sublime_text.exe+D4ADA``.
Good shit.

So this is gonna be complicated, at this point it just looks like a cesspool of indirect calls and no xrefs.


Honestly I'm getting lost. I need to know where that v7+72 comes from and I'm straying from the path.



[h20][<~The Big Gay~>]

So I was confused and I went back.
Noticed my code was wrong.
it is not
```c
License_Info__ = 0;
if(!Something_Lisence_->isRegistered)
  License_Info__ = 2
if(!Something_Lisence_->UpgradeRequired)
  License_Info__ |= 4;
```
but indeed
```c
License_Info__ = 0;
if(!*(char*)(Something_Lisence_->isRegistered))
  License_Info__ = 2
if(!*(char*)(Something_Lisence_->UpgradeRequired))
  License_Info__ |= 4;
```

Which means I've been chasing dumb shit. And guess what the best part is:

[img src="https://imgur.com/eD2DDV2.png"]

It's a fucking global pointer.

Care to see what happens when you change it to 1?

[img src="https://imgur.com/c6RAhyE.png"]

fml.

Anyway, that's cracked, it's initialized (compile-time) to 0, so all it really takes to crack subl is change that to 1.


[h20][<~The Juicy Info~>]

Offset of the variable for the current version (march 2018) is ``sublime_text.exe + 684920``
File offset is ``682320``.

I checked what accessed it, and found that it's accessed both when you change tabs (the title) and when you save (the message), so ye, cracked.

The 3 pieces of code that use it(for anyone wanting to make a sig):
```asm
.text:0000000140038F4C 48 8D 05 CD B9 64 00                                lea     rax, IsRegistered
.text:0000000140038F53 48 89 86 38 02 00 00                                mov     [rsi+238h], rax
.text:0000000140038F5A 33 ED                                               xor     ebp, ebp
.text:0000000140038F5C 48 89 AE 40 02 00 00                                mov     [rsi+240h], rbp
.text:0000000140038F63 48 89 AE 48 02 00 00                                mov     [rsi+248h], rbp
.text:0000000140038F6A 89 AE 50 02 00 00                                   mov     [rsi+250h], ebp
.text:0000000140038F70 41 83 CE FF                                         or      r14d, 0FFFFFFFFh
.text:0000000140038F74 66 44 89 B6 54 02 00 00                             mov     [rsi+254h], r14w
.text:0000000140038F7C 66 44 89 B6 56 02 00 00                             mov     [rsi+256h], r14w
.text:0000000140038F84 89 AE 78 02 00 00                                   mov     [rsi+278h], ebp
.text:0000000140038F8A 66 44 89 B6 7C 02 00 00                             mov     [rsi+27Ch], r14w
.text:0000000140038F92 66 44 89 B6 7E 02 00 00                             mov     [rsi+27Eh], r14w
.text:0000000140038F9A 48 89 AE A0 02 00 00                                mov     [rsi+2A0h], rbp
.text:0000000140038FA1 48 89 AE A8 02 00 00                                mov     [rsi+2A8h], rbp
.text:0000000140038FA8 48 89 AE B0 02 00 00                                mov     [rsi+2B0h], rbp
.text:0000000140038FAF 48 89 AE B8 02 00 00                                mov     [rsi+2B8h], rbp
.text:0000000140038FB6 48 89 AE C0 02 00 00                                mov     [rsi+2C0h], rbp
.text:0000000140038FBD 89 AE C8 02 00 00                                   mov     [rsi+2C8h], ebp
.text:0000000140038FC3 48 89 AE D0 02 00 00                                mov     [rsi+2D0h], rbp
.text:0000000140038FCA 48 89 AE D8 02 00 00                                mov     [rsi+2D8h], rbp
.text:0000000140038FD1 48 89 AE E0 02 00 00                                mov     [rsi+2E0h], rbp
.text:0000000140038FD8 B8 00 10 00 00                                      mov     eax, 1000h
.text:0000000140038FDD 48 89 86 E8 02 00 00                                mov     [rsi+2E8h], rax
.text:0000000140038FE4 48 89 86 F0 02 00 00                                mov     [rsi+2F0h], rax
.text:0000000140038FEB 48 89 AE F8 02 00 00                                mov     [rsi+2F8h], rbp
.text:0000000140038FF2 48 89 AE 00 03 00 00                                mov     [rsi+300h], rbp
.text:0000000140038FF9 48 89 AE 08 03 00 00                                mov     [rsi+308h], rbp
.text:0000000140039000 48 89 AE 10 03 00 00                                mov     [rsi+310h], rbp
.text:0000000140039007 48 89 AE 18 03 00 00                                mov     [rsi+318h], rbp
.text:000000014003900E 89 AE 20 03 00 00                                   mov     [rsi+320h], ebp
.text:0000000140039014 48 89 AE 28 03 00 00                                mov     [rsi+328h], rbp
.text:000000014003901B 48 89 AE 30 03 00 00                                mov     [rsi+330h], rbp
.text:0000000140039022 48 89 AE 38 03 00 00                                mov     [rsi+338h], rbp
.text:0000000140039029 48 89 86 40 03 00 00                                mov     [rsi+340h], rax
.text:0000000140039030 48 89 86 48 03 00 00                                mov     [rsi+348h], rax
.text:0000000140039037 48 89 AE 50 03 00 00                                mov     [rsi+350h], rbp
.text:000000014003903E 48 89 AE 58 03 00 00                                mov     [rsi+358h], rbp
.text:0000000140039045 48 89 AE 68 03 00 00                                mov     [rsi+368h], rbp
.text:000000014003904C 48 89 AE 70 03 00 00                                mov     [rsi+370h], rbp
.text:0000000140039053 48 89 AE 78 03 00 00                                mov     [rsi+378h], rbp
.text:000000014003905A 48 89 9E 88 03 00 00                                mov     [rsi+388h], rbx
.text:0000000140039061 48 89 BE 90 03 00 00                                mov     [rsi+390h], rdi
.text:0000000140039068 48 8B 44 24 70                                      mov     rax, [rsp+48h+arg_20]
.text:000000014003906D 48 89 86 98 03 00 00                                mov     [rsi+398h], rax
```

```asm
.text:0000000140079736 48 8D 0D E3 B1 60 00                                lea     rcx, IsRegistered
.text:000000014007973D E8 5A E1 FF FF                                      call    sub_14007789C
.text:0000000140079742 48 89 75 88                                         mov     [rbp-78h], rsi
.text:0000000140079746 48 8D 0D 3F FB FF FF                                lea     rcx, sub_14007928C
.text:000000014007974D 48 85 C9                                            test    rcx, rcx
.text:0000000140079750 74 1A                                               jz      short loc_14007976C
.text:0000000140079752 48 8D 05 47 C2 4A 00                                lea     rax, off_1405259A0
.text:0000000140079759 48 89 44 24 50                                      mov     [rsp+488h+var_438], rax
.text:000000014007975E 48 89 4C 24 58                                      mov     [rsp+488h+var_430], rcx
.text:0000000140079763 48 8D 44 24 50                                      lea     rax, [rsp+488h+var_438]
.text:0000000140079768 48 89 45 88                                         mov     [rbp-78h], rax
.text:000000014007976C
.text:000000014007976C                                     loc_14007976C:                          ; CODE XREF: sub_14007929C+4B4j
.text:000000014007976C 45 33 C0                                            xor     r8d, r8d
.text:000000014007976F 48 8D 54 24 50                                      lea     rdx, [rsp+488h+var_438]
.text:0000000140079774 48 8D 0D E5 08 63 00                                lea     rcx, qword_1406AA060
.text:000000014007977B E8 B4 3D 1D 00                                      call    sub_14024D534
.text:0000000140079780 90                                                  nop
.text:0000000140079781 48 8B 4D 88                                         mov     rcx, [rbp-78h]
.text:0000000140079785 48 85 C9                                            test    rcx, rcx
.text:0000000140079788 74 12                                               jz      short loc_14007979C
.text:000000014007978A 48 8B 01                                            mov     rax, [rcx]
.text:000000014007978D 48 8D 54 24 50                                      lea     rdx, [rsp+488h+var_438]
.text:0000000140079792 48 3B CA                                            cmp     rcx, rdx
.text:0000000140079795 0F 95 C2                                            setnz   dl
.text:0000000140079798 FF 50 20                                            call    qword ptr [rax+20h]
.text:000000014007979B 90                                                  nop
.text:000000014007979C
.text:000000014007979C                                     loc_14007979C:                          ; CODE XREF: sub_14007929C+498j
.text:000000014007979C                                                                             ; sub_14007929C+4ECj
.text:000000014007979C 48 8B 54 24 48                                      mov     rdx, [rsp+488h+var_440]
.text:00000001400797A1 48 83 FA 10                                         cmp     rdx, 10h
.text:00000001400797A5 72 11                                               jb      short loc_1400797B8
.text:00000001400797A7 48 FF C2                                            inc     rdx
.text:00000001400797AA 4D 8B C7                                            mov     r8, r15
.text:00000001400797AD 48 8B 4C 24 30                                      mov     rcx, qword ptr [rsp+488h+var_458]
.text:00000001400797B2 E8 39 B5 F8 FF                                      call    sub_140004CF0
.text:00000001400797B7 90                                                  nop
.text:00000001400797B8
.text:00000001400797B8                                     loc_1400797B8:                          ; CODE XREF: sub_14007929C+41Fj
.text:00000001400797B8                                                                             ; sub_14007929C+509j
.text:00000001400797B8 48 8D 4D 00                                         lea     rcx, [rbp+0]
.text:00000001400797BC E8 9F 46 14 00                                      call    sub_1401BDE60
.text:00000001400797C1 90                                                  nop
```

```asm
.text:00000001404AFF74 48 8D 0D A5 49 1D 00                                lea     rcx, IsRegistered
.text:00000001404AFF7B E9 EC 74 BC FF                                      jmp     sub_14007746C
.text:00000001404AFF80
.text:00000001404AFF80                                     ; =============== S U B R O U T I N E =======================================
.text:00000001404AFF80
.text:00000001404AFF80
.text:00000001404AFF80                                     sub_1404AFF80   proc near               ; DATA XREF: sub_140082F30+6Eo
.text:00000001404AFF80                                                                             ; .pdata:00000001406E450Co
.text:00000001404AFF80
.text:00000001404AFF80                                     var_18          = qword ptr -18h
.text:00000001404AFF80                                     arg_8           = qword ptr  10h
.text:00000001404AFF80                                     arg_10          = qword ptr  18h
.text:00000001404AFF80
.text:00000001404AFF80 40 57                                               push    rdi
.text:00000001404AFF82 48 83 EC 30                                         sub     rsp, 30h
.text:00000001404AFF86 48 C7 44 24 20 FE FF FF FF                          mov     [rsp+38h+var_18], 0FFFFFFFFFFFFFFFEh
.text:00000001404AFF8F 48 89 5C 24 48                                      mov     [rsp+38h+arg_8], rbx
.text:00000001404AFF94 48 89 74 24 50                                      mov     [rsp+38h+arg_10], rsi
.text:00000001404AFF99 48 8B 3D A0 1E 20 00                                mov     rdi, cs:qword_1406B1E40
.text:00000001404AFFA0 48 8B 1F                                            mov     rbx, [rdi]
.text:00000001404AFFA3 33 F6                                               xor     esi, esi
.text:00000001404AFFA5 48 3B DF                                            cmp     rbx, rdi
.text:00000001404AFFA8 74 55                                               jz      short loc_1404AFFFF
.text:00000001404AFFAA
.text:00000001404AFFAA                                     loc_1404AFFAA:                          ; CODE XREF: sub_1404AFF80+76j
.text:00000001404AFFAA 8B 53 40                                            mov     edx, [rbx+40h]
.text:00000001404AFFAD 48 8B 0D 9C 7F 1F 00                                mov     rcx, cs:qword_1406A7F50
.text:00000001404AFFB4 E8 FF 52 D9 FF                                      call    sub_1402452B8
.text:00000001404AFFB9 40 38 73 19                                         cmp     [rbx+19h], sil
.text:00000001404AFFBD 75 34                                               jnz     short loc_1404AFFF3
.text:00000001404AFFBF 48 8B 43 10                                         mov     rax, [rbx+10h]
.text:00000001404AFFC3 40 38 70 19                                         cmp     [rax+19h], sil
.text:00000001404AFFC7 75 0E                                               jnz     short loc_1404AFFD7
.text:00000001404AFFC9
.text:00000001404AFFC9                                     loc_1404AFFC9:                          ; CODE XREF: sub_1404AFF80+53j
.text:00000001404AFFC9 48 8B D8                                            mov     rbx, rax
.text:00000001404AFFCC 48 8B 00                                            mov     rax, [rax]
.text:00000001404AFFCF 40 38 70 19                                         cmp     [rax+19h], sil
.text:00000001404AFFD3 74 F4                                               jz      short loc_1404AFFC9
.text:00000001404AFFD5 EB 1C                                               jmp     short loc_1404AFFF3
.text:00000001404AFFD7                                     ; ---------------------------------------------------------------------------
.text:00000001404AFFD7
.text:00000001404AFFD7                                     loc_1404AFFD7:                          ; CODE XREF: sub_1404AFF80+47j
.text:00000001404AFFD7 48 8B 43 08                                         mov     rax, [rbx+8]
.text:00000001404AFFDB EB 0D                                               jmp     short loc_1404AFFEA
.text:00000001404AFFDD                                     ; ---------------------------------------------------------------------------
.text:00000001404AFFDD
.text:00000001404AFFDD                                     loc_1404AFFDD:                          ; CODE XREF: sub_1404AFF80+6Ej
.text:00000001404AFFDD 48 3B 58 10                                         cmp     rbx, [rax+10h]
.text:00000001404AFFE1 75 0D                                               jnz     short loc_1404AFFF0
.text:00000001404AFFE3 48 8B D8                                            mov     rbx, rax
.text:00000001404AFFE6 48 8B 40 08                                         mov     rax, [rax+8]
```



[h20][<~Le End~>]

cyaz
-->



<div id="lePost"><font size="20"> What </font><br>Decided to crack sublime text, not because I had to, just for fun, the message or unregistered thing never bothered me a bit. <br>Whenever I'll have $80 to throw around and support devs, I will, but until then, I'll have fun cracking shit.<br><br><br><font size="20"> TL;DR </font><br>I messed up bad in the beginning, made some bad assumptions, everything you need is in the first few lines of the "Process" section, and from "The Big Gay" down.<br><br><br><font size="20"> Process </font><br><br>Started with trying to find the (UNREGISTERED) thing. Was not in the strings.<br><br>So I went Imports, Since the window was always the same, they'd have to call SetWindowsText.<br><br>And there it was:<br><img src="https://imgur.com/J1wEAVg.png"><br><br>It had only 2 xrefs, and in the first you could find this:<br><img src="https://imgur.com/ZvFu0Fw.png"><br><br>Now if you notice on the left we have a bit of a loop. There's a weird ass string. <br>As we can see the loop xors the deference of the pointer by 0x15, and then increments the pointer.<br>Doing it yourself yeilds the following result:<br><img src="https://imgur.com/p1RqhNr.png"><br><br>Ez.<br><br>Now we've got 2 conditions onthere, the first checks is if (let's call it) "Somethung" &amp; 2, and if it's 1 it does the decrypt thing.<br>That tells us that that dword &amp; 2 is basically a <code class="smallcode">IsUnregistered</code><br><br>The other alternative is one that checks Somethung &amp; 4, and if that's true, it goes forward and calls SetWindowText, otherwise it seemingly appends "(LISENSE UPGRADE REQUIRED)", telling us that dword &amp; 4 is basically <code class="smallcode">IsLisenceUpgradNeeded</code>.<br><br>Maybe this'll be easier to visualize:<br><div class="codecontainer"><pre class="code _c"><code>if(license_info &amp; 2)<br>  showUNREGISTERED();<br>else if(license_info &amp; 4)<br>  showLICENSEUPGRADEREQUIRED();<br>else GoOn();<br></code></pre></div><br><br>Now we could just jmp the two conditions, be set and go on to crack the save message, but we preferably want to make the program itself think it's "registered", so anything else having the free version might trigger will go away.<br><br>So I trace it back. See what sets that value. Somwhere along the way I find this:<br><img src="https://imgur.com/PlF8tyF.png"><br><br>So now we know that that struct+1240+1 contains a byte/bool that seems to be <code class="smallcode">UpgradeRequired</code>. And also that struct+1240 contains a byte/bool for <code class="smallcode">IsRegistered</code>.<br><br>Again, easier to visualize:<br><div class="codecontainer"><pre class="code _c"><code>License_Info__ = 0;<br>if(!Something_Lisence_-&gt;isRegistered)<br> License_Info__ = 2<br>if(!Something_Lisence_-&gt;UpgradeRequired)<br> License_Info__ |= 4;<br></code></pre></div><br><br>Now, that <code class="smallcode">Something_License_</code> is the first param to that function (rcx). Function has a shit tone of xrefs tho (which is not at all bad, just means a lot of code uses it).<br>So now we go dynamic.<br><br>RCX doesn't seem to change between calls. Great! So let's see what accesses it.<br><img src="https://imgur.com/9O1sPaD.png"><br><br>Bit of a problem.<br>So those 204s you see, are when the cursor blinks, those 826s are when you move the mouse. So this seems to be some display class.<br>Since the class was passed as first param and this is display, chances are there's a vtable. Let's see.<br><img src="https://i.imgur.com/KOCwWhB.png"><br><br>Great, so we can go back to static.<br>So that 00007FF741F64060 - sublime_text.exe is <code class="smallcode">524060</code>:<br><img src="https://imgur.com/OUvKApn.png"><br><br>And since I coded a PE dumper with rtti, we can check what that actually is:<br><img src="https://imgur.com/wwD375y.png"><br><br>So <code class="smallcode">edit_window</code> with estimated 55 virtual functions. Doesn't help a lot since we already deduced that it was some kind of display stuff.<br><br>Okay, if we wanna find the license stuff, we gotta see how that edit_window+1240 is set. Now I find no reason as to why that would be set twice (besides someone actually activating it), so maybe check some kind of constructor.<br>Because this has a vtable, identifying a constructor is a matter of xrefing the vtable pointer.<br><br>A bit down on the first of 2 xrefed functions, we find:<br><img src="https://imgur.com/x4jqrHo.png"><br><br>The fact that that is a11 is great, because assuming this function is a constructor (and it sure looks like it), that'd be one of the params.<br>There's only 1 xref to this function:<br><img src="https://imgur.com/sNOEIhg.png"><br><br>v7+72, feeling it rn. v7 is a1 for that function, so let's bp it and see.<br>So it only seems to get called when you create another window. (What we need is something that is only called when sublime is started and maybe sporadically)<br><br>So now there's 2 things:<br><img src="https://imgur.com/fS9xdX2.png"><br><br>and a <code class="smallcode">524498</code> vtable<br><br><img src="https://imgur.com/C24PxyU.png"><br><br>window_list, cool.<br>So window_list + 72 is seemingly the license info.<br>I'm gonna go for that pointer first. <code class="smallcode">sublime_text.exe+6A7AD0</code><br><br>So, V7+72 always seems to have the same value, which is 0xC8. Now that doesn't really add up with the rest of the code we've been following and the values, but at least we know it's got something to do with the lisence.<br><br>Imma start it manually with x64dbg and hopefully bp it.<br>Results:<br><code class="smallcode">00007FF741A62CD8 (RVA:22CD8) | 4C 89 05 F1 4D 68 00     | mov qword ptr ds:[7FF7420E7AD0(RVA:6A7AD0)],r8      |</code><br><br>Great! IDA time.<br><img src="https://imgur.com/1q1sA9E.png"><br><br>Ok, so this seems to be what sets the pointers. Gladly there's only one xref.<br><br>And we're now seeing some cool shit!<br><img src="https://imgur.com/ObhDpH8.png"><br><img src="https://imgur.com/zSgFrfq.png"><br><img src="https://imgur.com/g0xv7ks.png"><br><br>This means we're close. But I doubt it's gonna be easy.<br><br>Anywho, we know from the prev function, the window_list is the third arg (r8), so let's see where it's set.<br>It would seem the binary does some weird stuff that confuses the decompiler, so this is gonna have to be asm only.<br><br>Here's the pointer to the previous function:<br><img src="https://imgur.com/3CllFsH.png"><br><br>And it's only used again towards the end of the function (in what I find is a weird fashion):<br><img src="https://imgur.com/PF6eyb4.png"><br>R8 is set before, depending on a condition, so chances are this is the 1st stack variable.<br><br>Anyhow, we'll need to bp this call (RVA: 3A744), otherwise there's no way to know what that function is, since the only xref to the current function is in rdata.<br>Feelsbad. Seems like it's never called!?<br>I mean the function itself is, so at least we can go back to the caller to see if there's something interesting.<br><br>~Fucking exceptions~<br><br>Okay, so I BPd the beginning and the end of the function, in the beginning there's no window, by the end there already is (with the unregistered window name and everything).<br>The call is made at <code class="smallcode">sublime_text.exe+D4ADA</code>.<br>Good shit.<br><br>So this is gonna be complicated, at this point it just looks like a cesspool of indirect calls and no xrefs.<br><br><br>Honestly I'm getting lost. I need to know where that v7+72 comes from and I'm straying from the path.<br><br><br><br><font size="20">The Big Gay</font><br><br>So I was confused and I went back.<br>Noticed my code was wrong.<br>it is not<br><div class="codecontainer"><pre class="code _c"><code>License_Info__ = 0;<br>if(!Something_Lisence_-&gt;isRegistered)<br> License_Info__ = 2<br>if(!Something_Lisence_-&gt;UpgradeRequired)<br> License_Info__ |= 4;<br></code></pre></div><br>but indeed<br><div class="codecontainer"><pre class="code _c"><code>License_Info__ = 0;<br>if(!*(char*)(Something_Lisence_-&gt;isRegistered))<br>  License_Info__ = 2<br>if(!*(char*)(Something_Lisence_-&gt;UpgradeRequired))<br> License_Info__ |= 4;<br></code></pre></div><br><br>Which means I've been chasing dumb shit. And guess what the best part is:<br><br><img src="https://imgur.com/eD2DDV2.png"><br><br>It's a fucking global pointer.<br><br>Care to see what happens when you change it to 1?<br><br><img src="https://imgur.com/c6RAhyE.png"><br><br>fml.<br><br>Anyway, that's cracked, it's initialized (compile-time) to 0, so all it really takes to crack subl is change that to 1.<br><br><br><font size="20">The Juicy Info</font><br><br>Offset of the variable for the current version (march 2018) is <code class="smallcode">sublime_text.exe + 684920</code><br>File offset is <code class="smallcode">682320</code>.<br><br>I checked what accessed it, and found that it's accessed both when you change tabs (the title) and when you save (the message), so ye, cracked.<br><br>The 3 pieces of code that use it(for anyone wanting to make a sig):<br><div class="codecontainer"><pre class="code _asm"><code>.text:0000000140038F4C 48 8D 05 CD B9 64 00                                lea     rax, IsRegistered<br>.text:0000000140038F53 48 89 86 38 02 00 00                                mov     [rsi+238h], rax<br>.text:0000000140038F5A 33 ED                                               xor     ebp, ebp<br>.text:0000000140038F5C 48 89 AE 40 02 00 00                                mov     [rsi+240h], rbp<br>.text:0000000140038F63 48 89 AE 48 02 00 00                                mov     [rsi+248h], rbp<br>.text:0000000140038F6A 89 AE 50 02 00 00                                   mov     [rsi+250h], ebp<br>.text:0000000140038F70 41 83 CE FF                                         or      r14d, 0FFFFFFFFh<br>.text:0000000140038F74 66 44 89 B6 54 02 00 00                             mov     [rsi+254h], r14w<br>.text:0000000140038F7C 66 44 89 B6 56 02 00 00                             mov     [rsi+256h], r14w<br>.text:0000000140038F84 89 AE 78 02 00 00                                   mov     [rsi+278h], ebp<br>.text:0000000140038F8A 66 44 89 B6 7C 02 00 00                             mov     [rsi+27Ch], r14w<br>.text:0000000140038F92 66 44 89 B6 7E 02 00 00                             mov     [rsi+27Eh], r14w<br>.text:0000000140038F9A 48 89 AE A0 02 00 00                                mov     [rsi+2A0h], rbp<br>.text:0000000140038FA1 48 89 AE A8 02 00 00                                mov     [rsi+2A8h], rbp<br>.text:0000000140038FA8 48 89 AE B0 02 00 00                                mov     [rsi+2B0h], rbp<br>.text:0000000140038FAF 48 89 AE B8 02 00 00                                mov     [rsi+2B8h], rbp<br>.text:0000000140038FB6 48 89 AE C0 02 00 00                                mov     [rsi+2C0h], rbp<br>.text:0000000140038FBD 89 AE C8 02 00 00                                   mov     [rsi+2C8h], ebp<br>.text:0000000140038FC3 48 89 AE D0 02 00 00                                mov     [rsi+2D0h], rbp<br>.text:0000000140038FCA 48 89 AE D8 02 00 00                                mov     [rsi+2D8h], rbp<br>.text:0000000140038FD1 48 89 AE E0 02 00 00                                mov     [rsi+2E0h], rbp<br>.text:0000000140038FD8 B8 00 10 00 00                                      mov     eax, 1000h<br>.text:0000000140038FDD 48 89 86 E8 02 00 00                                mov     [rsi+2E8h], rax<br>.text:0000000140038FE4 48 89 86 F0 02 00 00                                mov     [rsi+2F0h], rax<br>.text:0000000140038FEB 48 89 AE F8 02 00 00                                mov     [rsi+2F8h], rbp<br>.text:0000000140038FF2 48 89 AE 00 03 00 00                                mov     [rsi+300h], rbp<br>.text:0000000140038FF9 48 89 AE 08 03 00 00                                mov     [rsi+308h], rbp<br>.text:0000000140039000 48 89 AE 10 03 00 00                                mov     [rsi+310h], rbp<br>.text:0000000140039007 48 89 AE 18 03 00 00                                mov     [rsi+318h], rbp<br>.text:000000014003900E 89 AE 20 03 00 00                                   mov     [rsi+320h], ebp<br>.text:0000000140039014 48 89 AE 28 03 00 00                                mov     [rsi+328h], rbp<br>.text:000000014003901B 48 89 AE 30 03 00 00                                mov     [rsi+330h], rbp<br>.text:0000000140039022 48 89 AE 38 03 00 00                                mov     [rsi+338h], rbp<br>.text:0000000140039029 48 89 86 40 03 00 00                                mov     [rsi+340h], rax<br>.text:0000000140039030 48 89 86 48 03 00 00                                mov     [rsi+348h], rax<br>.text:0000000140039037 48 89 AE 50 03 00 00                                mov     [rsi+350h], rbp<br>.text:000000014003903E 48 89 AE 58 03 00 00                                mov     [rsi+358h], rbp<br>.text:0000000140039045 48 89 AE 68 03 00 00                                mov     [rsi+368h], rbp<br>.text:000000014003904C 48 89 AE 70 03 00 00                                mov     [rsi+370h], rbp<br>.text:0000000140039053 48 89 AE 78 03 00 00                                mov     [rsi+378h], rbp<br>.text:000000014003905A 48 89 9E 88 03 00 00                                mov     [rsi+388h], rbx<br>.text:0000000140039061 48 89 BE 90 03 00 00                                mov     [rsi+390h], rdi<br>.text:0000000140039068 48 8B 44 24 70                                      mov     rax, [rsp+48h+arg_20]<br>.text:000000014003906D 48 89 86 98 03 00 00                                mov     [rsi+398h], rax<br></code></pre></div><br><br><div class="codecontainer"><pre class="code _asm"><code>.text:0000000140079736 48 8D 0D E3 B1 60 00                                lea     rcx, IsRegistered<br>.text:000000014007973D E8 5A E1 FF FF                                      call    sub_14007789C<br>.text:0000000140079742 48 89 75 88                                         mov     [rbp-78h], rsi<br>.text:0000000140079746 48 8D 0D 3F FB FF FF                                lea     rcx, sub_14007928C<br>.text:000000014007974D 48 85 C9                                            test    rcx, rcx<br>.text:0000000140079750 74 1A                                               jz      short loc_14007976C<br>.text:0000000140079752 48 8D 05 47 C2 4A 00                                lea     rax, off_1405259A0<br>.text:0000000140079759 48 89 44 24 50                                      mov     [rsp+488h+var_438], rax<br>.text:000000014007975E 48 89 4C 24 58                                      mov     [rsp+488h+var_430], rcx<br>.text:0000000140079763 48 8D 44 24 50                                      lea     rax, [rsp+488h+var_438]<br>.text:0000000140079768 48 89 45 88                                         mov     [rbp-78h], rax<br>.text:000000014007976C<br>.text:000000014007976C                                     loc_14007976C:                          ; CODE XREF: sub_14007929C+4B4j<br>.text:000000014007976C 45 33 C0                                            xor     r8d, r8d<br>.text:000000014007976F 48 8D 54 24 50                                      lea     rdx, [rsp+488h+var_438]<br>.text:0000000140079774 48 8D 0D E5 08 63 00                                lea     rcx, qword_1406AA060<br>.text:000000014007977B E8 B4 3D 1D 00                                      call    sub_14024D534<br>.text:0000000140079780 90                                                  nop<br>.text:0000000140079781 48 8B 4D 88                                         mov     rcx, [rbp-78h]<br>.text:0000000140079785 48 85 C9                                            test    rcx, rcx<br>.text:0000000140079788 74 12                                               jz      short loc_14007979C<br>.text:000000014007978A 48 8B 01                                            mov     rax, [rcx]<br>.text:000000014007978D 48 8D 54 24 50                                      lea     rdx, [rsp+488h+var_438]<br>.text:0000000140079792 48 3B CA                                            cmp     rcx, rdx<br>.text:0000000140079795 0F 95 C2                                            setnz   dl<br>.text:0000000140079798 FF 50 20                                            call    qword ptr [rax+20h]<br>.text:000000014007979B 90                                                  nop<br>.text:000000014007979C<br>.text:000000014007979C                                     loc_14007979C:                          ; CODE XREF: sub_14007929C+498j<br>.text:000000014007979C                                                                             ; sub_14007929C+4ECj<br>.text:000000014007979C 48 8B 54 24 48                                      mov     rdx, [rsp+488h+var_440]<br>.text:00000001400797A1 48 83 FA 10                                         cmp     rdx, 10h<br>.text:00000001400797A5 72 11                                               jb      short loc_1400797B8<br>.text:00000001400797A7 48 FF C2                                            inc     rdx<br>.text:00000001400797AA 4D 8B C7                                            mov     r8, r15<br>.text:00000001400797AD 48 8B 4C 24 30                                      mov     rcx, qword ptr [rsp+488h+var_458]<br>.text:00000001400797B2 E8 39 B5 F8 FF                                      call    sub_140004CF0<br>.text:00000001400797B7 90                                                  nop<br>.text:00000001400797B8<br>.text:00000001400797B8                                     loc_1400797B8:                          ; CODE XREF: sub_14007929C+41Fj<br>.text:00000001400797B8                                                                             ; sub_14007929C+509j<br>.text:00000001400797B8 48 8D 4D 00                                         lea     rcx, [rbp+0]<br>.text:00000001400797BC E8 9F 46 14 00                                      call    sub_1401BDE60<br>.text:00000001400797C1 90                                                  nop<br></code></pre></div><br><br><div class="codecontainer"><pre class="code _asm"><code>.text:00000001404AFF74 48 8D 0D A5 49 1D 00                                lea     rcx, IsRegistered<br>.text:00000001404AFF7B E9 EC 74 BC FF                                      jmp     sub_14007746C<br>.text:00000001404AFF80<br>.text:00000001404AFF80                                     ; =============== S U B R O U T I N E =======================================<br>.text:00000001404AFF80<br>.text:00000001404AFF80<br>.text:00000001404AFF80                                     sub_1404AFF80   proc near               ; DATA XREF: sub_140082F30+6Eo<br>.text:00000001404AFF80                                                                             ; .pdata:00000001406E450Co<br>.text:00000001404AFF80<br>.text:00000001404AFF80                                     var_18          = qword ptr -18h<br>.text:00000001404AFF80                                     arg_8           = qword ptr  10h<br>.text:00000001404AFF80                                     arg_10          = qword ptr  18h<br>.text:00000001404AFF80<br>.text:00000001404AFF80 40 57                                               push    rdi<br>.text:00000001404AFF82 48 83 EC 30                                         sub     rsp, 30h<br>.text:00000001404AFF86 48 C7 44 24 20 FE FF FF FF                          mov     [rsp+38h+var_18], 0FFFFFFFFFFFFFFFEh<br>.text:00000001404AFF8F 48 89 5C 24 48                                      mov     [rsp+38h+arg_8], rbx<br>.text:00000001404AFF94 48 89 74 24 50                                      mov     [rsp+38h+arg_10], rsi<br>.text:00000001404AFF99 48 8B 3D A0 1E 20 00                                mov     rdi, cs:qword_1406B1E40<br>.text:00000001404AFFA0 48 8B 1F                                            mov     rbx, [rdi]<br>.text:00000001404AFFA3 33 F6                                               xor     esi, esi<br>.text:00000001404AFFA5 48 3B DF                                            cmp     rbx, rdi<br>.text:00000001404AFFA8 74 55                                               jz      short loc_1404AFFFF<br>.text:00000001404AFFAA<br>.text:00000001404AFFAA                                     loc_1404AFFAA:                          ; CODE XREF: sub_1404AFF80+76j<br>.text:00000001404AFFAA 8B 53 40                                            mov     edx, [rbx+40h]<br>.text:00000001404AFFAD 48 8B 0D 9C 7F 1F 00                                mov     rcx, cs:qword_1406A7F50<br>.text:00000001404AFFB4 E8 FF 52 D9 FF                                      call    sub_1402452B8<br>.text:00000001404AFFB9 40 38 73 19                                         cmp     [rbx+19h], sil<br>.text:00000001404AFFBD 75 34                                               jnz     short loc_1404AFFF3<br>.text:00000001404AFFBF 48 8B 43 10                                         mov     rax, [rbx+10h]<br>.text:00000001404AFFC3 40 38 70 19                                         cmp     [rax+19h], sil<br>.text:00000001404AFFC7 75 0E                                               jnz     short loc_1404AFFD7<br>.text:00000001404AFFC9<br>.text:00000001404AFFC9                                     loc_1404AFFC9:                          ; CODE XREF: sub_1404AFF80+53j<br>.text:00000001404AFFC9 48 8B D8                                            mov     rbx, rax<br>.text:00000001404AFFCC 48 8B 00                                            mov     rax, [rax]<br>.text:00000001404AFFCF 40 38 70 19                                         cmp     [rax+19h], sil<br>.text:00000001404AFFD3 74 F4                                               jz      short loc_1404AFFC9<br>.text:00000001404AFFD5 EB 1C                                               jmp     short loc_1404AFFF3<br>.text:00000001404AFFD7                                     ; ---------------------------------------------------------------------------<br>.text:00000001404AFFD7<br>.text:00000001404AFFD7                                     loc_1404AFFD7:                          ; CODE XREF: sub_1404AFF80+47j<br>.text:00000001404AFFD7 48 8B 43 08                                         mov     rax, [rbx+8]<br>.text:00000001404AFFDB EB 0D                                               jmp     short loc_1404AFFEA<br>.text:00000001404AFFDD                                     ; ---------------------------------------------------------------------------<br>.text:00000001404AFFDD<br>.text:00000001404AFFDD                                     loc_1404AFFDD:                          ; CODE XREF: sub_1404AFF80+6Ej<br>.text:00000001404AFFDD 48 3B 58 10                                         cmp     rbx, [rax+10h]<br>.text:00000001404AFFE1 75 0D                                               jnz     short loc_1404AFFF0<br>.text:00000001404AFFE3 48 8B D8                                            mov     rbx, rax<br>.text:00000001404AFFE6 48 8B 40 08                                         mov     rax, [rax+8]<br></code></pre></div><br><br><br><br><font size="20">Le End</font><br><br>cyaz<br><br><br><br><br><br><br><br><br><br><br><br><br></div>
  </div>
  
</div>

</body>
</html>
